package dao

import (
	"cve-sa-backend/models"
	"cve-sa-backend/utils"

	"gorm.io/gorm"
)

func CreateOsv(data models.OeCompatibilityOsv, tx *gorm.DB) error {
	return tx.Model(&models.OeCompatibilityOsv{}).Create(&data).Error
}

func ExistsOsv(version string, tx *gorm.DB) (bool, error) {
	var exists models.OeCompatibilityOsv
	err := tx.Where("os_version = ?", version).First(&exists).Error
	if err != nil {
		if utils.ErrorNotFound(err) {
			return false, nil
		}
		return false, err
	}
	return true, nil
}

func UpdateOsv(data models.OeCompatibilityOsv, tx *gorm.DB) error {
	return tx.Model(&models.OeCompatibilityOsv{}).Where("os_version = ?", data.OsVersion).Updates(&data).Error
}

func DeleteOsv(version string, tx *gorm.DB) error {
	return tx.Exec("delete from oe_compatibility_osv where os_version = ?", version).Error
}
